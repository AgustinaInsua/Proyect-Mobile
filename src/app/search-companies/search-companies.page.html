<ion-app>
  <p-toast></p-toast>
  <app-header title="Buscar Empresas" icon="search"></app-header>
  <app-menu></app-menu>
  <ion-content>
    <p-menubar [model]="items"></p-menubar>
    <p-breadcrumb [model]="items"></p-breadcrumb>
    <p-dialog [(visible)]="display" [modal]="true" [style]="{ width: '24vw', height: '35vw' }" position="center">
      <ng-template pTemplate="header">
          <h2>Calculadora</h2>
      </ng-template>
      <ng-template pTemplate="content">
        <div class="inputs">
          <label>Fecha de primer pago</label>
          <p-calendar [(ngModel)]="value" [showIcon]="true" placeholder="Seleccione..."></p-calendar>
          <label>Aprobador</label>
          <p-dropdown [options]="aprobadores" [(ngModel)]="selecAprobador" placeholder="Seleccione..."></p-dropdown>
          <label>Cantidad de pagos</label>
          <p-dropdown [options]="amountPayments" [(ngModel)]="selecAmountPayments" placeholder="Seleccione..."></p-dropdown>
          <label>Periocidad</label>
          <p-dropdown [options]="periodicity" [(ngModel)]="selecPeriodicity" placeholder="Seleccione..."></p-dropdown>
        </div>
      </ng-template>
      <ng-template pTemplate="footer">
        <div class="buttonAcept"><p-button>Aceptar</p-button></div>
          <div class="buttonCancel"><p-button>Cancelar</p-button></div>
      </ng-template>
    </p-dialog>
    <div class="containerFilters">
      <div class="containerFilters_inputs">
        <label for="inputCuit">{{ "INPUTS.CUIT" | translate}}</label>
        <input
          id="inputCuit"
          type="text"
          (input)="dtCompanies.filter($any($event.target).value,'cuit','contains')"
          (onFocus)="dtCompanies.filter($any($event.target).value,'cuit','contains')"
          (onBlur)="dtCompanies.filter($any($event.target).value,'cuit','contains')"
          pInputText
        >
      </div>
      <div class="containerFilters_inputs">
        <label for="inputRazonS">{{"INPUTS.RAZON" | translate}}</label>
      <input 
        id="inputRazonS"
        type="text"      
        (input)="dtCompanies.filter($any($event.target).value,'razonSocial','contains')"
        (onFocus)="dtCompanies.filter($any($event.target).value,'razonSocial','contains')"
        (onBlur)="dtCompanies.filter($any($event.target).value,'razonSocial','contains')"
        pInputText
        >
      </div>
    </div>
    <div class="mainTable">
      <p-table
        id="tableCompanies"
        #dtCompanies
        [value]="companies"
        [tableStyle]="{ 'min-width': '50rem' }"
        [paginator]="true"
        [rows]="3"
        [rowsPerPageOptions]="[1, 2, 3]"
        [globalFilterFields]="['id', 'razonSocial', 'cuit', 'email', 'contactName', 'contactNumber']"
        (onFilter)="onFilter($event, dtCompanies)"
        selectionMode="single"
        autocomplete="off"
      >
        <ng-template pTemplate="caption">
          <div class="companies__flex">
            <div class="flex__clear">
              <button
                pButton
                label="Limpiar"
                class="p-button-outlined"
                icon="pi pi-filter-slash"
                (click)="clear(dtCompanies)"
              ></button>
            </div>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th
              *ngFor="let column of fieldsTableCompany"
              pSortableColumn="{{column.field}}"
            >
              {{column.title}}
              <p-sortIcon field="{{column.field}}"></p-sortIcon>
              <p-columnFilter
                type={{column.type}}
                field={{column.field}}
                display="menu"
              ></p-columnFilter>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-company let-i="rowIndex">
          <tr>
            <td>{{ company.id }}</td>
            <td>{{ company.razonSocial }}</td>
            <td>{{ company.cuit }}</td>
            <td>{{ company.email }}</td>
            <td>{{ company.contactName }}</td>
            <td>{{ company.contactNumber }}</td>
            <td>
              <div class="optionsButtons">
                <div id="search">
                  <div class="info"> 
                    <p id="buscarActas">Buscar Boleta</p>
                  </div>
                <p-button (click)="searchActas(i)"  icon="pi pi-search"></p-button>
              </div>
                <div id="pencil">
                  <div class="info"> 
                    <p id="editarActas">Editar Actas</p>
                  </div>
                  <p-button (click)="editData(i)" icon="pi pi-pencil"></p-button>
                </div>
                <div id="print">
                  <div class="info"> 
                    <p id="imprimirActas">Imprimir Actas</p>
                  </div>
                  <a href="http://localhost:3003/companies/companies.pdf/{{company.id}}" target="_blank"><p-button icon="pi pi-print"></p-button></a>
                </div>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

  </ion-content>
</ion-app>
